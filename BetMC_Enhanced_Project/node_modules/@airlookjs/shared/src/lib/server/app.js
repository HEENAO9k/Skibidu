import fastify from 'fastify';
const defaultConfig = {
    routePrefix: '/api',
    shares: [],
    rateLimit: {
        max: 50,
        timeWindow: '1 minute'
    },
    cors: {
        origin: '*'
    }
};
export const getBuildFunction = (register, defaults) => {
    const build = async (config, fastifyOptions = {}) => {
        const app = fastify(fastifyOptions);
        const c = { ...defaultConfig, ...defaults, ...config };
        if (c.rateLimit) {
            await app.register(import('@fastify/rate-limit'), c.rateLimit);
        }
        if (c.cors) {
            await app.register(import('@fastify/cors'), c.cors);
        }
        await register(app, c);
        return app;
    };
    return build;
};
//# sourceMappingURL=app.js.map